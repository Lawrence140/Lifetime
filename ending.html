<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise Escape Scene</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #d4d4dc;
            text-align: center;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #5a6b8c;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #2d5016;
            color: #e8f4d7;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            border: 1px solid #4a6b2f;
        }
        button:hover {
            background: #3a5f28;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>Loading Sunrise Escape Scene...</h2>
        <p>The escape sequence will begin automatically</p>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let camera, scene, renderer;
        let backgroundMusic, demonAttackSound, audioLoader, listener;

        function showFloatingText2(text, duration = 4000, type = "dialogue") {
            console.log(`[${type.toUpperCase()}] ${text}`);
            
            const el = document.createElement('div');
            let styles = {
                position: 'fixed',
                left: '50%',
                transform: 'translateX(-50%)',
                padding: '15px 20px',
                borderRadius: '8px',
                fontFamily: '"Courier New", monospace',
                zIndex: '9998',
                opacity: '0',
                transition: 'all 800ms ease',
                textAlign: 'center',
                maxWidth: '70%',
                wordWrap: 'break-word',
                backdropFilter: 'blur(10px)',
                border: '1px solid',
                lineHeight: '1.4'
            };

            if (type === "dialogue") {
                styles.background = 'linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.9) 100%)';
                styles.color = '#d4d4dc';
                styles.borderColor = '#5a6b8c';
                styles.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.6)';
                styles.top = '25%';
                styles.fontSize = '17px';
            } else if (type === "warning") {
                styles.background = 'linear-gradient(135deg, rgba(60, 20, 20, 0.95) 0%, rgba(40, 10, 10, 0.9) 100%)';
                styles.color = '#d4a0a0';
                styles.borderColor = '#8b4513';
                styles.boxShadow = '0 4px 20px rgba(139, 0, 0, 0.4)';
                styles.top = '22%';
                styles.fontSize = '16px';
            } else if (type === "sunrise") {
                styles.background = 'linear-gradient(135deg, rgba(60, 80, 100, 0.9) 0%, rgba(40, 60, 80, 0.8) 100%)';
                styles.color = '#e8f4f8';
                styles.borderColor = '#87a0b4';
                styles.boxShadow = '0 4px 20px rgba(100, 140, 180, 0.3)';
                styles.top = '30%';
                styles.fontSize = '18px';
                styles.fontWeight = 'bold';
            }

            Object.assign(el.style, styles);
            el.textContent = text;
            document.body.appendChild(el);

            requestAnimationFrame(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateX(-50%) translateY(0px)';
            });

            setTimeout(() => {
                el.style.opacity = '0';
                el.style.transform = 'translateX(-50%) translateY(-20px)';
                setTimeout(() => {
                    if (el.parentNode) el.parentNode.removeChild(el);
                }, 800);
            }, duration);
        }

        function restartGame() {
            console.log("Restarting game...");
            location.reload();
        }

        function quitGame() {
            console.log("Quitting game...");
            if (confirm("Return to level select?")) {
                // In a real game, this would go to level select
                // For demo purposes, just reload
                location.reload();
            }
        }

        backgroundMusic = {
            isPlaying: false,
            stop: () => console.log("Background music stopped"),
            pause: () => console.log("Background music paused")
        };

        demonAttackSound = {
            isPlaying: false,
            stop: () => console.log("Demon attack sound stopped")
        };

        audioLoader = {
            load: (url, onLoad, onProgress, onError) => {
                console.log(`Would load audio: ${url}`);
                setTimeout(() => {
                    if (onLoad) onLoad({});
                }, 100);
            }
        };

        listener = {};

        // Create realistic tree with trunk and foliage
        function createRealisticTree(scale = 1) {
            const tree = new THREE.Group();
            
            // Trunk with natural brown color and texture
            const trunkGeometry = new THREE.CylinderGeometry(0.3 * scale, 0.4 * scale, 3 * scale, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x3a2818,
                roughness: 0.9,
                metalness: 0.1
            });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 1.5 * scale;
            tree.add(trunk);
            
            // Multiple layers of foliage for realistic look
            const foliageColor = 0x2d5016;
            const foliageMaterial = new THREE.MeshStandardMaterial({ 
                color: foliageColor,
                roughness: 0.85,
                metalness: 0.0
            });
            
            // Bottom layer
            const foliage1 = new THREE.Mesh(
                new THREE.ConeGeometry(1.5 * scale, 2 * scale, 8),
                foliageMaterial
            );
            foliage1.position.y = 3.5 * scale;
            tree.add(foliage1);
            
            // Middle layer
            const foliage2 = new THREE.Mesh(
                new THREE.ConeGeometry(1.2 * scale, 1.8 * scale, 8),
                new THREE.MeshStandardMaterial({ 
                    color: 0x355d1a,
                    roughness: 0.85
                })
            );
            foliage2.position.y = 4.5 * scale;
            tree.add(foliage2);
            
            // Top layer
            const foliage3 = new THREE.Mesh(
                new THREE.ConeGeometry(0.8 * scale, 1.5 * scale, 8),
                new THREE.MeshStandardMaterial({ 
                    color: 0x3d6b1f,
                    roughness: 0.85
                })
            );
            foliage3.position.y = 5.5 * scale;
            tree.add(foliage3);
            
            return tree;
        }

        // Create realistic shrub/bush
        function createShrub(scale = 1) {
            const shrub = new THREE.Group();
            
            // Multiple spheres to create irregular bush shape
            const shrubMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x3a5f28,
                roughness: 0.9
            });
            
            for (let i = 0; i < 3 + Math.floor(Math.random() * 3); i++) {
                const sphere = new THREE.Mesh(
                    new THREE.SphereGeometry(0.3 * scale + Math.random() * 0.3 * scale, 8, 8),
                    shrubMaterial
                );
                sphere.position.set(
                    (Math.random() - 0.5) * 0.6 * scale,
                    Math.random() * 0.4 * scale,
                    (Math.random() - 0.5) * 0.6 * scale
                );
                shrub.add(sphere);
            }
            
            return shrub;
        }

        // Create realistic house with proper architecture
        function createRealisticHouse() {
            const house = new THREE.Group();
            
            // Main house body - textured brick color
            const mainBody = new THREE.Mesh(
                new THREE.BoxGeometry(12, 8, 10),
                new THREE.MeshStandardMaterial({ 
                    color: 0x6b5a47,
                    roughness: 0.8,
                    metalness: 0.2
                })
            );
            mainBody.position.y = 4;
            house.add(mainBody);
            
            // Roof with realistic shingled appearance
            const roofGeometry = new THREE.ConeGeometry(9, 4, 4);
            const roofMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x4a2c1f,
                roughness: 0.7,
                metalness: 0.1
            });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = 10;
            roof.rotation.y = Math.PI / 4;
            house.add(roof);
            
            // Windows
            const windowMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a3a5a,
                emissive: 0x2a4a6a,
                emissiveIntensity: 0.1,
                roughness: 0.1,
                metalness: 0.5
            });
            
            // Front windows
            const windowPositions = [
                [-3, 5, 5.1],
                [3, 5, 5.1],
                [-3, 2.5, 5.1],
                [3, 2.5, 5.1]
            ];
            
            windowPositions.forEach(pos => {
                const window = new THREE.Mesh(
                    new THREE.BoxGeometry(1.5, 2, 0.2),
                    windowMaterial
                );
                window.position.set(...pos);
                house.add(window);
            });
            
            // Door
            const door = new THREE.Mesh(
                new THREE.BoxGeometry(2, 3.5, 0.3),
                new THREE.MeshStandardMaterial({ 
                    color: 0x3d2817,
                    roughness: 0.6
                })
            );
            door.position.set(0, 1.75, 5.15);
            house.add(door);
            
            // Chimney
            const chimney = new THREE.Mesh(
                new THREE.BoxGeometry(1, 3, 1),
                new THREE.MeshStandardMaterial({ 
                    color: 0x6b4423,
                    roughness: 0.9
                })
            );
            chimney.position.set(4, 10.5, 2);
            house.add(chimney);
            
            return house;
        }

        function createSunriseEscapeScene() {
            console.log("Creating sunrise escape scene...");
            
            const escapeScene = new THREE.Scene();
            escapeScene.background = new THREE.Color(0x0a0a1a);

            // Realistic grass ground with subtle variation
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshStandardMaterial({ 
                    color: 0x2d3a1f,
                    roughness: 0.9,
                    metalness: 0.0
                })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.5;
            ground.receiveShadow = true;
            escapeScene.add(ground);

            // Add realistic trees in a natural arrangement
            const treePositions = [
                { x: -18, z: 20, scale: 1.2 },
                { x: -12, z: 25, scale: 1.0 },
                { x: 15, z: 22, scale: 1.3 },
                { x: 20, z: 18, scale: 1.1 },
                { x: -22, z: -15, scale: 1.0 },
                { x: -15, z: -20, scale: 1.2 },
                { x: 18, z: -18, scale: 1.1 },
                { x: 22, z: -12, scale: 1.0 },
                { x: -25, z: 5, scale: 1.3 },
                { x: 24, z: 8, scale: 1.1 }
            ];
            
            treePositions.forEach(pos => {
                const tree = createRealisticTree(pos.scale);
                tree.position.set(pos.x, -0.5, pos.z);
                tree.rotation.y = Math.random() * Math.PI * 2;
                escapeScene.add(tree);
            });

            // Add shrubs around the yard
            for (let i = 0; i < 20; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 8 + Math.random() * 6;
                const shrub = createShrub(0.8 + Math.random() * 0.4);
                shrub.position.set(
                    Math.cos(angle) * radius,
                    -0.3,
                    Math.sin(angle) * radius
                );
                shrub.rotation.y = Math.random() * Math.PI * 2;
                escapeScene.add(shrub);
            }

            // Add realistic house
            const house = createRealisticHouse();
            house.position.set(0, 0, 15);
            house.castShadow = true;
            escapeScene.add(house);

            // Add subtle flowers in muted colors
            for (let i = 0; i < 25; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 4 + Math.random() * 10;
                
                const flowerColors = [0x6b4668, 0x8b7355, 0x7d8b55, 0xa0522d, 0x696969];
                const flower = new THREE.Mesh(
                    new THREE.SphereGeometry(0.15, 8, 8),
                    new THREE.MeshStandardMaterial({ 
                        color: flowerColors[Math.floor(Math.random() * flowerColors.length)],
                        roughness: 0.8,
                        emissiveIntensity: 0.05
                    })
                );
                flower.position.set(
                    Math.cos(angle) * radius,
                    -0.3,
                    Math.sin(angle) * radius
                );
                escapeScene.add(flower);
                
                // Flower stem
                const stem = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.03, 0.03, 0.5, 4),
                    new THREE.MeshStandardMaterial({ color: 0x2d5016 })
                );
                stem.position.set(
                    Math.cos(angle) * radius,
                    -0.5,
                    Math.sin(angle) * radius
                );
                escapeScene.add(stem);
            }

            const sunriseData = {
                startTime: Date.now(),
                duration: 30000,
                isComplete: false
            };

            // Deep night lighting
            const ambientNight = new THREE.AmbientLight(0x1a1a2a, 0.2);
            escapeScene.add(ambientNight);

            // Cool moonlight
            const moonLight = new THREE.DirectionalLight(0x556688, 0.3);
            moonLight.position.set(-15, 20, -15);
            moonLight.castShadow = true;
            escapeScene.add(moonLight);

            // Sunrise light (sun)
            const sunriseLight = new THREE.DirectionalLight(0xff8c42, 0.0);
            sunriseLight.position.set(15, 2, -20);
            sunriseLight.castShadow = true;
            escapeScene.add(sunriseLight);

            // Warm hemisphere light for natural color transition
            const hemisphereLight = new THREE.HemisphereLight(0x556688, 0x2d3a1f, 0.0);
            escapeScene.add(hemisphereLight);

            // Atmospheric ambient for depth
            const atmosphericAmbient = new THREE.AmbientLight(0xffa07a, 0.0);
            escapeScene.add(atmosphericAmbient);

            escapeScene.userData.sunrise = {
                data: sunriseData,
                ambientNight: ambientNight,
                moonLight: moonLight,
                sunriseLight: sunriseLight,
                hemisphereLight: hemisphereLight,
                atmosphericAmbient: atmosphericAmbient
            };

            console.log("Sunrise escape scene created successfully");
            return escapeScene;
        }

        function updateSunrise(escapeScene) {
            if (!escapeScene.userData.sunrise) return;
            
            const sunrise = escapeScene.userData.sunrise;
            const elapsed = Date.now() - sunrise.data.startTime;
            const progress = Math.min(elapsed / sunrise.data.duration, 1);
            
            // Smooth easing for natural transition
            const easeProgress = progress < 0.5 
                ? 2 * progress * progress 
                : 1 - Math.pow(-2 * progress + 2, 2) / 2;
            
            if (progress >= 1 && !sunrise.data.isComplete) {
                sunrise.data.isComplete = true;
                console.log("Sunrise complete!");
            }

            // Natural sky color progression - more muted and realistic
            if (progress < 0.3) {
                // Deep night to pre-dawn (dark blue to deep purple-blue)
                const nightColor = new THREE.Color(0x0a0a1a);
                const preDawnColor = new THREE.Color(0x1a1a3a);
                escapeScene.background = nightColor.clone().lerp(preDawnColor, progress / 0.3);
            } else if (progress < 0.5) {
                // Pre-dawn to first light (purple-blue to slate gray)
                const preDawnColor = new THREE.Color(0x1a1a3a);
                const firstLightColor = new THREE.Color(0x2a3a4a);
                const t = (progress - 0.3) / 0.2;
                escapeScene.background = preDawnColor.clone().lerp(firstLightColor, t);
            } else if (progress < 0.7) {
                // First light to morning (slate gray to soft blue-gray)
                const firstLightColor = new THREE.Color(0x2a3a4a);
                const morningColor = new THREE.Color(0x4a5a6a);
                const t = (progress - 0.5) / 0.2;
                escapeScene.background = firstLightColor.clone().lerp(morningColor, t);
            } else {
                // Morning to day (blue-gray to soft sky blue)
                const morningColor = new THREE.Color(0x4a5a6a);
                const dayColor = new THREE.Color(0x6a7a8a);
                const t = (progress - 0.7) / 0.3;
                escapeScene.background = morningColor.clone().lerp(dayColor, t);
            }

            // Natural light intensity changes
            sunrise.ambientNight.intensity = 0.2 * (1 - easeProgress);
            sunrise.moonLight.intensity = 0.3 * (1 - easeProgress);
            
            // Sun intensity grows naturally
            if (progress < 0.4) {
                sunrise.sunriseLight.intensity = progress * 0.3;
            } else {
                sunrise.sunriseLight.intensity = 0.12 + (progress - 0.4) * 0.8;
            }
            
            // Hemisphere light for natural ambient
            sunrise.hemisphereLight.intensity = easeProgress * 0.4;
            
            // Atmospheric warmth - very subtle
            sunrise.atmosphericAmbient.intensity = Math.max(0, Math.sin(progress * Math.PI)) * 0.15;

            // Natural sun color transition: deep orange -> muted orange -> soft yellow
            if (progress < 0.5) {
                // Deep orange to muted orange
                sunrise.sunriseLight.color.setHex(0xff8c42);
            } else if (progress < 0.7) {
                // Muted orange to soft yellow
                const t = (progress - 0.5) / 0.2;
                const orange = new THREE.Color(0xff8c42);
                const yellow = new THREE.Color(0xffd8a0);
                sunrise.sunriseLight.color = orange.lerp(yellow, t);
            } else {
                // Soft yellow to pale light
                const t = (progress - 0.7) / 0.3;
                const yellow = new THREE.Color(0xffd8a0);
                const white = new THREE.Color(0xfff8f0);
                sunrise.sunriseLight.color = yellow.lerp(white, t);
            }

            // Natural sun movement - rises from horizon to sky
            sunrise.sunriseLight.position.y = 2 + easeProgress * 25;
            sunrise.sunriseLight.position.x = 15 - easeProgress * 8;
            sunrise.sunriseLight.position.z = -20 + easeProgress * 10;
        }

        function triggerEscapeSequence() {
            console.log("Starting escape sequence...");
            
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
            
            backgroundMusic.stop();
            demonAttackSound.stop();
            
            const escapeScene = createSunriseEscapeScene();
            scene = escapeScene;
            
            camera.position.set(0, 1.6, -10);
            camera.lookAt(0, 1.6, 15);
            
            audioLoader.load('sounds/morning_birds.wav', function(buffer) {
                console.log("Morning birds loaded and playing");
            }, undefined, function(error) {
                console.warn("Could not load morning sounds - this is expected in test");
            });
            
            function animateSunrise() {
                if (scene.userData.sunrise) {
                    updateSunrise(scene);
                }
                renderer.render(scene, camera);
                requestAnimationFrame(animateSunrise);
            }
            animateSunrise();
            
            startEndingDialogueSequence();
        }

        function startEndingDialogueSequence() {
            console.log("Starting ending dialogue sequence...");
            
            setTimeout(() => {
                showFloatingText2("I'm out... I'm finally out.", 4000, "dialogue");
                
                setTimeout(() => {
                    showFloatingText2("The air... it feels clean. New.", 4000, "dialogue");
                    
                    setTimeout(() => {
                        showFloatingText2("That thing in there said my father's abuse...", 4500, "dialogue");
                        
                        setTimeout(() => {
                            showFloatingText2("...was never about anger.", 3500, "dialogue");
                            
                            setTimeout(() => {
                                showFloatingText2("It was preparation.", 3000, "dialogue");
                                
                                setTimeout(() => {
                                    showFloatingText2("Every blow, every cruel word...", 4000, "dialogue");
                                    
                                    setTimeout(() => {
                                        showFloatingText2("...was to harden me.", 3500, "dialogue");
                                        
                                        setTimeout(() => {
                                            showFloatingText2("To make me the perfect vessel...", 4500, "dialogue");
                                            
                                            setTimeout(() => {
                                                const truthOverlay = document.createElement('div');
                                                truthOverlay.style.cssText = `
                                                    position: fixed;
                                                    top: 0;
                                                    left: 0;
                                                    width: 100%;
                                                    height: 100%;
                                                    background: radial-gradient(circle, rgba(80, 40, 40, 0.9) 0%, rgba(20, 10, 10, 0.95) 70%);
                                                    color: #d4b896;
                                                    display: flex;
                                                    flex-direction: column;
                                                    justify-content: center;
                                                    align-items: center;
                                                    z-index: 10002;
                                                    font-family: 'Courier New', monospace;
                                                    text-align: center;
                                                    opacity: 0;
                                                    transition: opacity 3s ease-in;
                                                `;
                                                truthOverlay.innerHTML = `
                                                    <div style="font-size: 2.5em; font-weight: bold; margin-bottom: 30px; line-height: 1.3;">
                                                        IT WAS NEVER ABOUT BREAKING ME
                                                    </div>
                                                    <div style="font-size: 2em; margin-bottom: 20px;">
                                                        It was about forging me
                                                    </div>
                                                    <div style="font-size: 1.8em; color: #b8a086;">
                                                        Into something strong enough to contain a demon
                                                    </div>
                                                `;
                                                document.body.appendChild(truthOverlay);
                                                
                                                setTimeout(() => {
                                                    truthOverlay.style.opacity = '1';
                                                }, 100);
                                                
                                                setTimeout(() => {
                                                    truthOverlay.style.opacity = '0';
                                                    setTimeout(() => {
                                                        if (truthOverlay.parentNode) {
                                                            truthOverlay.parentNode.removeChild(truthOverlay);
                                                        }
                                                        continueEndingSequence();
                                                    }, 3000);
                                                }, 10000);
                                                
                                            }, 4000);
                                        }, 3500);
                                    }, 4000);
                                }, 3500);
                            }, 3000);
                        }, 4500);
                    }, 4000);
                }, 4000);
            }, 2000);
        }

        function continueEndingSequence() {
            console.log("Continuing ending sequence...");
            
            setTimeout(() => {
                showFloatingText2("But I escaped...", 3500, "dialogue");
                
                setTimeout(() => {
                    showFloatingText2("I broke the cycle.", 3000, "dialogue");
                    
                    setTimeout(() => {
                        showFloatingText2("His plan failed.", 2500, "dialogue");
                        
                        setTimeout(() => {
                            showFloatingText2("I'm not a vessel...", 3000, "dialogue");
                            
                            setTimeout(() => {
                                showFloatingText2("I'm free.", 4000, "dialogue");
                                
                                setTimeout(() => {
                                    showFloatingText2("The sun is rising...", 3000, "sunrise");
                                    
                                    setTimeout(() => {
                                        showFloatingText2("A new day begins.", 4000, "sunrise");
                                        
                                        setTimeout(() => {
                                            showFinalSunriseEndingScreen();
                                        }, 5000);
                                    }, 3500);
                                }, 3000);
                            }, 3000);
                        }, 2500);
                    }, 3000);
                }, 3500);
            }, 2000);
        }

        function showFinalSunriseEndingScreen() {
            console.log("Showing final sunrise ending screen...");
            
            const endingOverlay = document.createElement('div');
            endingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #2a3a4a 0%, #4a5a6a 30%, #6a7a8a 100%);
                color: #d4d4dc;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 10003;
                font-family: 'Courier New', monospace;
                text-align: center;
                opacity: 0;
                transition: opacity 4s ease-in;
            `;
            
            endingOverlay.innerHTML = `
                <div style="max-width: 800px; padding: 40px; background: rgba(40, 40, 50, 0.3); backdrop-filter: blur(10px); border-radius: 15px; border: 1px solid rgba(100, 120, 140, 0.3);">
                    <h1 style="font-size: 3.5em; margin-bottom: 40px; color: #e8f4f8; letter-spacing: 2px;">
                        DAWN
                    </h1>
                    
                    <div style="font-size: 1.3em; line-height: 1.6; margin-bottom: 50px; color: #c4d4e4;">
                        <p style="margin-bottom: 25px;">
                            The darkness of the past fades with the night.
                        </p>
                        <p style="margin-bottom: 25px;">
                            What was meant to break you became your strength.
                        </p>
                        <p style="font-style: italic; color: #a8b8c8; font-weight: bold; margin-top: 30px;">
                            Today is the first day of your true life.
                        </p>
                    </div>
                    
                    <div style="font-size: 1.1em; color: #b4c4d4; margin-bottom: 60px; line-height: 1.5;">
                        The cycle is broken. The ritual failed.<br>
                        <strong style="color: #d4e4f4;">You are not what they tried to make you.</strong>
                    </div>
                    
                    <div style="font-size: 1.1em; color: #c4d4e4; font-style: italic;">
                        Continuing to credits...
                    </div>
                </div>
            `;
            
            document.body.appendChild(endingOverlay);
            
            setTimeout(() => {
                endingOverlay.style.opacity = '1';
            }, 100);
            
            // Redirect to credits after 10 seconds
            setTimeout(() => {
                console.log("Redirecting to credits...");
                window.location.href = 'credits.html';
            }, 15000); // Redirect after 10 seconds
        }

        function init() {
            console.log("Initializing sunrise escape scene...");
            
            // Initialize Three.js
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            
            // Start the escape sequence automatically after a brief loading period
            setTimeout(() => {
                triggerEscapeSequence();
            }, 1000);
        }

        window.addEventListener('load', init);

        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        window.restartGame = restartGame;
        window.quitGame = quitGame;

    </script>
</body>
</html>